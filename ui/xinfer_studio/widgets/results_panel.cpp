#include "results_panel.h"
#include "./ui_results_panel.h" // Generated by CMake/uic

ResultsPanel::ResultsPanel(QWidget *parent) :
    QWidget(parent),
    ui(new Ui::ResultsPanel)
{
    ui->setupUi(this);

    // Set column width ratios
    ui->treeWidget->setColumnWidth(0, 120); // Class
    ui->treeWidget->setColumnWidth(1, 60);  // Conf
    // Location stretches
}

ResultsPanel::~ResultsPanel() {
    delete ui;
}

void ResultsPanel::clear() {
    ui->treeWidget->clear();
}

void ResultsPanel::updateDetections(const std::vector<xinfer::postproc::BoundingBox>& boxes) {
    ui->treeWidget->clear();

    for (const auto& box : boxes) {
        auto item = new QTreeWidgetItem(ui->treeWidget);

        // Column 0: Class Label
        item->setText(0, "Class " + QString::number(box.class_id));

        // Column 1: Confidence
        item->setText(1, QString::number(box.confidence * 100, 'f', 0) + "%");

        // Column 2: Location
        QString loc = QString("[%1, %2]").arg((int)box.x1).arg((int)box.y1);
        item->setText(2, loc);
    }
}